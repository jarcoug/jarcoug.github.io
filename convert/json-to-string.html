<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON转字符串工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!--<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">-->
	<link href="https://cdn.jsdmirror.com/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563EB',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        neutral: '#64748B'
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .transition-smooth {
                transition: all 0.25s ease;
            }
            .editor-shadow {
                box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.05);
            }
            .btn-hover {
                @apply hover:shadow-md transform hover:-translate-y-0.5 transition-smooth;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- 页面标题 -->
        <header class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-4">
                <i class="fa fa-exchange text-primary text-2xl"></i>
            </div>
            <h1 class="text-[clamp(1.5rem,3vw,2.2rem)] font-bold text-gray-800 mb-2">JSON 转字符串工具</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">将JSON格式数据转换为字符串，支持格式化和特殊字符处理</p>
        </header>
        
        <!-- 主内容区 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- 左侧：JSON输入区 -->
            <div>
                <div class="flex items-center justify-between mb-2">
                    <label class="block text-sm font-medium text-gray-700">
                        JSON 输入
                    </label>
                    <div class="flex space-x-1">
                        <button id="format-json" class="text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-gray-700 transition-smooth">
                            <i class="fa fa-indent mr-1"></i>格式化
                        </button>
                        <button id="clear-json" class="text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-gray-700 transition-smooth">
                            <i class="fa fa-trash mr-1"></i>清空
                        </button>
                    </div>
                </div>
                <div class="relative">
                    <textarea 
                        id="json-input" 
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth resize-none editor-shadow min-h-[300px]"
                        placeholder='请输入JSON格式数据，例如：{"name":"测试","value":123}'
                    ></textarea>
                    <div id="json-error" class="absolute top-2 right-2 text-danger text-xs hidden">
                        <i class="fa fa-exclamation-circle mr-1"></i>无效的JSON
                    </div>
                </div>
                <div class="mt-2 text-xs text-gray-500">
                    <i class="fa fa-info-circle mr-1"></i>请输入有效的JSON格式数据
                </div>
            </div>
            
            <!-- 右侧：字符串输出区 -->
            <div>
                <div class="flex items-center justify-between mb-2">
                    <label class="block text-sm font-medium text-gray-700">
                        字符串输出
                    </label>
                    <div class="flex space-x-1">
                        <button id="copy-string" class="text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-gray-700 transition-smooth" disabled>
                            <i class="fa fa-copy mr-1"></i>复制
                        </button>
                        <button id="clear-string" class="text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded text-gray-700 transition-smooth" disabled>
                            <i class="fa fa-trash mr-1"></i>清空
                        </button>
                    </div>
                </div>
                <div class="relative">
                    <textarea 
                        id="string-output" 
                        class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth resize-none editor-shadow min-h-[300px] font-mono text-sm"
                        placeholder="转换后的字符串将显示在这里..."
                        readonly
                    ></textarea>
                    <div id="copy-success" class="absolute top-2 right-2 text-secondary text-xs hidden">
                        <i class="fa fa-check-circle mr-1"></i>已复制
                    </div>
                </div>
                <div class="mt-2 text-xs text-gray-500">
                    <i class="fa fa-info-circle mr-1"></i>JSON转换后的字符串结果，包含转义字符
                </div>
            </div>
        </div>
        
        <!-- 转换选项和按钮 -->
        <div class="bg-white p-5 rounded-xl editor-shadow mb-8">
            <h3 class="text-sm font-medium text-gray-700 mb-3">转换选项</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div class="flex items-center">
                    <input type="checkbox" id="escape-slashes" checked 
                        class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                    <label for="escape-slashes" class="ml-2 text-sm text-gray-700">
                        转义斜杠 (/)
                    </label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="add-quotes" 
                        class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                    <label for="add-quotes" class="ml-2 text-sm text-gray-700">
                        添加外层引号
                    </label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="preserve-whitespace" 
                        class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                    <label for="preserve-whitespace" class="ml-2 text-sm text-gray-700">
                        保留空白字符并转义为\r\n
                    </label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="convert-numbers" checked 
                        class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                    <label for="convert-numbers" class="ml-2 text-sm text-gray-700">
                        保持数字类型（不转为字符串）
                    </label>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-3">
                <button 
                    id="convert-btn" 
                    class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-smooth flex items-center justify-center btn-hover"
                >
                    <i class="fa fa-arrow-right mr-2"></i>JSON 转 字符串
                </button>
                <button 
                    id="reverse-btn" 
                    class="flex-1 bg-neutral hover:bg-neutral/90 text-white font-medium py-3 px-4 rounded-lg transition-smooth flex items-center justify-center btn-hover"
                >
                    <i class="fa fa-arrow-left mr-2"></i>字符串 转 JSON
                </button>
            </div>
        </div>
        
        <!-- 示例和说明 -->
        <div class="bg-gray-50 border border-gray-200 rounded-xl p-5">
            <h3 class="text-sm font-medium text-gray-700 mb-3">使用示例</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div>
                    <div class="text-xs text-gray-500 mb-1">JSON 输入示例：</div>
                    <div class="bg-white p-2 rounded text-xs font-mono border border-gray-200">
                        {<br>
                        &nbsp;&nbsp;"name": "测试",<br>
                        &nbsp;&nbsp;"age": 25,<br>
                        &nbsp;&nbsp;"score": 98.5,<br>
                        &nbsp;&nbsp;"hasCert": true<br>
                        }
                    </div>
                </div>
                <div>
                    <div class="text-xs text-gray-500 mb-1">字符串输出（数字类型保持）：</div>
                    <div class="bg-white p-2 rounded text-xs font-mono border border-gray-200 overflow-x-auto">
                        {"name":"测试","age":25,"score":98.5,"hasCert":true}
                    </div>
                    <div class="text-xs text-gray-500 mt-2 mb-1">字符串输出（数字转为字符串）：</div>
                    <div class="bg-white p-2 rounded text-xs font-mono border border-gray-200 overflow-x-auto">
                        {"name":"测试","age":"25","score":"98.5","hasCert":true}
                    </div>
                </div>
            </div>
            
            <div class="mt-4 text-sm text-gray-700">
                <h4 class="font-medium text-gray-800 mb-1">工具说明</h4>
                <p class="text-xs mt-1">
                    本工具可以将JSON格式的数据转换为字符串格式，优化了数字类型处理：
                    当启用"保持数字类型"选项时，数字将以原始数字格式存在（如25、98.5）；
                    禁用此选项时，所有数字值将被转换为字符串类型（如"25"、"98.5"）。
                    同时支持空白字符转义处理，将换行符转换为\\n，回车符转换为\\r等。
                </p>
            </div>
        </div>
    </div>
    
    <!-- 页脚 -->
    <footer class="mt-10 py-4 text-center text-gray-500 text-sm">
        <p>JSON转字符串工具 © 2025 | 在线JSON与字符串互转</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const jsonInput = document.getElementById('json-input');
            const stringOutput = document.getElementById('string-output');
            const convertBtn = document.getElementById('convert-btn');
            const reverseBtn = document.getElementById('reverse-btn');
            const formatJsonBtn = document.getElementById('format-json');
            const clearJsonBtn = document.getElementById('clear-json');
            const clearStringBtn = document.getElementById('clear-string');
            const copyStringBtn = document.getElementById('copy-string');
            const jsonError = document.getElementById('json-error');
            const copySuccess = document.getElementById('copy-success');
            
            // 选项复选框
            const escapeSlashes = document.getElementById('escape-slashes');
            const addQuotes = document.getElementById('add-quotes');
            const preserveWhitespace = document.getElementById('preserve-whitespace');
            const convertNumbers = document.getElementById('convert-numbers');
            
            // 隐藏所有提示
            function hideAllAlerts() {
                jsonError.classList.add('hidden');
                copySuccess.classList.add('hidden');
            }
            
            // 更新按钮状态
            function updateButtonStates() {
                const jsonHasContent = jsonInput.value.trim().length > 0;
                const stringHasContent = stringOutput.value.trim().length > 0;
                
                convertBtn.disabled = !jsonHasContent;
                reverseBtn.disabled = !stringHasContent;
                clearJsonBtn.disabled = !jsonHasContent;
                clearStringBtn.disabled = !stringHasContent;
                copyStringBtn.disabled = !stringHasContent;
                formatJsonBtn.disabled = !jsonHasContent;
            }
            
            // 递归处理数字类型转换
            function processNumbers(obj, keepNumbers) {
                // 如果是数组，递归处理每个元素
                if (Array.isArray(obj)) {
                    return obj.map(item => processNumbers(item, keepNumbers));
                }
                // 如果是对象，递归处理每个属性
                else if (obj !== null && typeof obj === 'object') {
                    const result = {};
                    for (const key in obj) {
                        if (obj.hasOwnProperty(key)) {
                            result[key] = processNumbers(obj[key], keepNumbers);
                        }
                    }
                    return result;
                }
                // 如果是数字且不需要保持数字类型，则转换为字符串
                else if (typeof obj === 'number' && !keepNumbers) {
                    return obj.toString();
                }
                // 其他类型保持不变
                else {
                    return obj;
                }
            }
            
            // 处理空白字符转义
            function escapeWhitespace(str) {
                return str
                    .replace(/\r/g, '\\r')  // 转义回车符
                    .replace(/\n/g, '\\n')  // 转义换行符
                    .replace(/\t/g, '\\t'); // 转义制表符
            }
            
            // 反转空白字符转义
            function unescapeWhitespace(str) {
                return str
                    .replace(/\\r/g, '\r')  // 还原回车符
                    .replace(/\\n/g, '\n')  // 还原换行符
                    .replace(/\\t/g, '\t'); // 还原制表符
            }
            
            // JSON转字符串
            function jsonToString() {
                hideAllAlerts();
                const json = jsonInput.value.trim();
                
                if (!json) return;
                
                try {
                    // 解析JSON以验证格式
                    let parsedJson = JSON.parse(json);
                    
                    // 处理数字类型转换
                    parsedJson = processNumbers(parsedJson, convertNumbers.checked);
                    
                    // 确定缩进
                    const space = preserveWhitespace.checked ? 2 : 0;
                    
                    // 转换为字符串
                    let result = JSON.stringify(parsedJson, null, space);
                    
                    // 处理空白字符转义
                    if (preserveWhitespace.checked) {
                        result = escapeWhitespace(result);
                    }
                    
                    // 处理斜杠转义
                    if (escapeSlashes.checked) {
                        result = result.replace(/\//g, '\\/');
                    }
                    
                    // 添加外层引号
                    if (addQuotes.checked) {
                        result = `"${result.replace(/"/g, '\\"')}"`;
                    }
                    
                    // 显示结果
                    stringOutput.value = result;
                    updateButtonStates();
                } catch (error) {
                    console.error('JSON转换错误:', error);
                    jsonError.classList.remove('hidden');
                    stringOutput.value = '';
                    updateButtonStates();
                }
            }
            
            // 字符串转JSON
            function stringToJson() {
                hideAllAlerts();
                let str = stringOutput.value.trim();
                
                if (!str) return;
                
                try {
                    // 移除可能的外层引号
                    if (str.startsWith('"') && str.endsWith('"')) {
                        str = str.slice(1, -1).replace(/\\"/g, '"');
                    }
                    
                    // 反转义斜杠
                    if (escapeSlashes.checked) {
                        str = str.replace(/\\\//g, '/');
                    }
                    
                    // 反转换空白字符
                    if (preserveWhitespace.checked) {
                        str = unescapeWhitespace(str);
                    }
                    
                    // 解析字符串为JSON
                    const parsedJson = JSON.parse(str);
                    
                    // 格式化JSON
                    const formattedJson = JSON.stringify(parsedJson, null, 2);
                    
                    // 显示结果
                    jsonInput.value = formattedJson;
                    hideAllAlerts();
                    updateButtonStates();
                } catch (error) {
                    console.error('字符串转JSON错误:', error);
                    jsonError.classList.remove('hidden');
                    jsonInput.value = '';
                    updateButtonStates();
                }
            }
            
            // 格式化JSON
            function formatJson() {
                hideAllAlerts();
                const json = jsonInput.value.trim();
                
                if (!json) return;
                
                try {
                    const parsedJson = JSON.parse(json);
                    const formattedJson = JSON.stringify(parsedJson, null, 2);
                    jsonInput.value = formattedJson;
                } catch (error) {
                    console.error('JSON格式化错误:', error);
                    jsonError.classList.remove('hidden');
                }
            }
            
            // 清空JSON输入
            function clearJson() {
                jsonInput.value = '';
                hideAllAlerts();
                updateButtonStates();
                jsonInput.focus();
            }
            
            // 清空字符串输出
            function clearString() {
                stringOutput.value = '';
                hideAllAlerts();
                updateButtonStates();
            }
            
            // 复制字符串到剪贴板
            function copyString() {
                const text = stringOutput.value;
                if (text) {
                    navigator.clipboard.writeText(text).then(() => {
                        copySuccess.classList.remove('hidden');
                        setTimeout(() => {
                            copySuccess.classList.add('hidden');
                        }, 2000);
                    }).catch(err => {
                        console.error('复制失败:', err);
                        // 备用复制方法
                        const textarea = document.createElement('textarea');
                        textarea.value = text;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        
                        copySuccess.classList.remove('hidden');
                        setTimeout(() => {
                            copySuccess.classList.add('hidden');
                        }, 2000);
                    });
                }
            }
            
            // 事件监听
            convertBtn.addEventListener('click', jsonToString);
            reverseBtn.addEventListener('click', stringToJson);
            formatJsonBtn.addEventListener('click', formatJson);
            clearJsonBtn.addEventListener('click', clearJson);
            clearStringBtn.addEventListener('click', clearString);
            copyStringBtn.addEventListener('click', copyString);
            
            // 输入变化时更新按钮状态
            jsonInput.addEventListener('input', function() {
                hideAllAlerts();
                updateButtonStates();
            });
            
            stringOutput.addEventListener('input', function() {
                hideAllAlerts();
                updateButtonStates();
            });
            
            // 选项变化时重新转换
            [escapeSlashes, addQuotes, preserveWhitespace, convertNumbers].forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (jsonInput.value.trim()) {
                        jsonToString();
                    }
                });
            });
            
            // 初始化按钮状态
            updateButtonStates();
            
            // 示例数据
            const exampleJson = `{
    "name": "示例数据",
    "version": 1.0,
    "count": 100,
    "activeUsers": 5682,
    "rating": 4.75,
    "isReleased": true,
    "description": "包含多种数字类型\\n整数、浮点数等"
}`;
            jsonInput.value = exampleJson;
            updateButtonStates();
            jsonToString();
        });
    </script>
</body>
</html>
